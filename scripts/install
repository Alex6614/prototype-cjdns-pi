#!/usr/bin/env bash

set -e

TAG_PROTOTYPE_CJDNS_PI2=master

sudo apt-get update

# Get git
if ! [ "$(which git)" ]; then
    sudo apt-get install git -y
fi

# Download prototype-cjdns-pi2 repo
if ! [ -d "prototype-cjdns-pi2" ]; then
    git clone https://github.com/tomeshnet/prototype-cjdns-pi2.git
fi
cd prototype-cjdns-pi2

# Checkout provided tag or TAG_PROTOTYPE_CJDNS_PI2
if [ ! -z "$TAG" ]; then
    git checkout $TAG
elif
    git checkout $TAG_PROTOTYPE_CJDNS_PI2
fi

# Export environment variables
export WITH_MESH_POINT
export WITH_WIFI_AP
export WITH_IPFS

# Run the actual installation script
./install2
